---
title: 上下文理解
tags:
  - 中断、进程
categories: '内核'
comments: true
copyright: true
date: 2018-10-22 11:00:59
---



_ _ _
# 举例：  

　　定时器到了，执行定时器的handler function，这算处于中断上下文。

　　内核调度，调度的线程、进程，这算处于进程上下文。。。


_ _ _

# 中断线程化：  

　　内核中有一个中断线程化的概念，属于中断下半部的范畴，中断线程是可以被调度的，处于进程上下文。

# workqueue  

　　在中断线程化机制合入Linux内核之前，中断下半部的三种旧实现机制（SoftIRQ、tasklet、workqueue）中的workqueue，就有了一些中断线程化的影子。**workqueue的基本原理就是把需要推迟执行的工作，交由一个内核线程来执行，**它是利用进程上下文来执行中断下半部的操作，因此workqueue允许重新调度和睡眠。

_ _ _

# 中断上下文和中断上半部下半部  

　　在这里容易混淆中断上下文和中断上半部下半部的概念。中断上下文指的是中断发生时，CPU响应一个中断并执行中断服务程序时，内核处于中断上下文。**中断服务程序处于中断上半部，然后一些耗时的操作会放在下半部执行。**换句话说，一个完整的中断处理流程包含中断处理程序和中断下半部。**我们经常说中断上下文中不能调用含有睡眠的函数，其实与中断上半段不能执行一些耗时操作的说法是一致的。**
